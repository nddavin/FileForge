import{r as n,j as e}from"./radix-vendor-DXnqCESz.js";import{j as W,C as k,e as C,k as S,b as A,c as H,I as Q,B as f,l as V}from"./index-DHeBa6N9.js";import{S as X,f as q,g as D,h as G,M as T,X as U,i as Y,j as J,k as K,l as _}from"./icons-vendor-4PzZcNxV.js";import"./react-vendor-BS3SOam5.js";import"./utils-vendor-CbK4XRml.js";import"./date-vendor-Cb250gQT.js";function I(l){const p=l.map((t,a)=>{var r,i,d;return{id:t.id,name:t.name,type:t.type,series:(r=t.metadata)==null?void 0:r.series,speaker:(i=t.metadata)==null?void 0:i.speaker,status:(d=t.metadata)==null?void 0:d.status,x:150+a%4*200,y:100+Math.floor(a/4)*150}}),h=[],c=new Map;l.forEach(t=>{var r;const a=(r=t.metadata)==null?void 0:r.series;a&&(c.has(a)||c.set(a,[]),c.get(a).push(t.id))}),c.forEach(t=>{for(let a=0;a<t.length-1;a++)h.push({source:t[a],target:t[a+1],label:"Series",type:"series"})});const x=new Map;l.forEach(t=>{var r;const a=(r=t.metadata)==null?void 0:r.speaker;a&&(x.has(a)||x.set(a,[]),x.get(a).push(t.id))}),x.forEach(t=>{if(t.length>1)for(let a=0;a<t.length-1;a++)h.some(i=>i.source===t[a]&&i.target===t[a+1]||i.source===t[a+1]&&i.target===t[a])||h.push({source:t[a],target:t[a+1],label:"Same Speaker",type:"cross-reference"})});for(let t=0;t<Math.min(l.length-1,3);t++)h.push({source:l[t].id,target:l[t+1].id,label:"Related",type:"related"});return{nodes:p,edges:h}}function ie({className:l}){const{files:p,loading:h}=W(),[c,x]=n.useState(1),[t,a]=n.useState({x:0,y:0}),[r,i]=n.useState(null),[d,L]=n.useState(""),[j,M]=n.useState(null),{nodes:g,edges:R}=n.useMemo(()=>p.length===0?{nodes:[],edges:[]}:I(p),[p]),E=n.useMemo(()=>{if(!d)return g;const s=d.toLowerCase();return g.filter(u=>{var m,o;return u.name.toLowerCase().includes(s)||((m=u.series)==null?void 0:m.toLowerCase().includes(s))||((o=u.speaker)==null?void 0:o.toLowerCase().includes(s))})},[g,d]),Z=n.useCallback(()=>{x(s=>Math.min(s+.2,2))},[]),B=n.useCallback(()=>{x(s=>Math.max(s-.2,.4))},[]),O=n.useCallback(()=>{x(1),a({x:0,y:0})},[]),P=s=>s.startsWith("audio/")?J:s.startsWith("video/")?K:_,z=s=>{switch(s){case"series":return"#3b82f6";case"cross-reference":return"#8b5cf6";case"related":return"#10b981";default:return"#6b7280"}},w=s=>({x:s.x*c+t.x,y:s.y*c+t.y});return h?e.jsx(k,{className:S("",l),children:e.jsx(C,{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"text-lg text-gray-500",children:"Loading relationships..."})})}):p.length===0?e.jsx(k,{className:S("",l),children:e.jsxs(C,{className:"flex flex-col items-center justify-center h-96",children:[e.jsx(X,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No files to visualize"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload files with metadata to see their relationships"})]})}):e.jsxs(k,{className:S("overflow-hidden",l),children:[e.jsxs(A,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{className:"text-lg",children:"File Relationships"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(Q,{placeholder:"Search files...",value:d,onChange:s=>L(s.target.value),className:"pl-9 w-48 h-8"})]}),e.jsx(f,{variant:"outline",size:"icon",onClick:B,children:e.jsx(D,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-gray-500 min-w-[3rem] text-center",children:[Math.round(c*100),"%"]}),e.jsx(f,{variant:"outline",size:"icon",onClick:Z,children:e.jsx(G,{className:"w-4 h-4"})}),e.jsx(f,{variant:"outline",size:"icon",onClick:O,children:e.jsx(T,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-0.5 bg-blue-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Series"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-0.5 bg-purple-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Cross-reference"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-0.5 bg-green-500"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Related"})]})]})]}),e.jsx(C,{className:"p-0",children:e.jsxs("div",{className:"relative bg-gray-50 h-[500px] overflow-hidden",children:[e.jsx("svg",{className:"w-full h-full",viewBox:"0 0 800 500",children:e.jsxs("g",{transform:`translate(${t.x}, ${t.y}) scale(${c})`,children:[R.map((s,u)=>{const m=g.find(v=>v.id===s.source),o=g.find(v=>v.id===s.target);if(!m||!o)return null;const b=(j==null?void 0:j.source)===s.source&&(j==null?void 0:j.target)===s.target,N=w(m),y=w(o),F=(N.x+y.x)/2,$=(N.y+y.y)/2;return e.jsxs("g",{children:[e.jsx("line",{x1:N.x+60,y1:N.y+40,x2:y.x+60,y2:y.y+40,stroke:z(s.type),strokeWidth:b?3:1.5,strokeOpacity:b?1:.5,className:"transition-all cursor-pointer",onMouseEnter:()=>M(s),onMouseLeave:()=>M(null)}),b&&s.label&&e.jsxs("g",{children:[e.jsx("rect",{x:F-30,y:$-10,width:s.label.length*6+20,height:20,rx:4,fill:"white",stroke:z(s.type)}),e.jsx("text",{x:F,y:$+4,textAnchor:"middle",fontSize:11,fill:"#374151",children:s.label})]})]},`${s.source}-${s.target}-${u}`)}),E.map(s=>{const u=P(s.type),m=w(s),o=(r==null?void 0:r.id)===s.id;return e.jsxs("g",{transform:`translate(${m.x}, ${m.y})`,className:"cursor-pointer transition-all",onClick:()=>i(o?null:s),children:[e.jsx("rect",{width:120,height:80,rx:8,fill:"white",stroke:o?"#3b82f6":"#e5e7eb",strokeWidth:o?2:1,className:"shadow-sm"}),e.jsx("foreignObject",{width:120,height:80,children:e.jsxs("div",{className:"p-3 flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-blue-500 flex-shrink-0"}),e.jsx("span",{className:"text-xs font-medium truncate flex-1",children:s.name})]}),s.series&&e.jsx(V,{variant:"secondary",className:"mt-1 text-[10px] h-5",children:s.series}),s.speaker&&e.jsx("span",{className:"text-[10px] text-gray-500 mt-1",children:s.speaker})]})})]},s.id)})]})}),r&&e.jsxs("div",{className:"absolute bottom-4 left-4 bg-white rounded-lg shadow-lg p-4 w-64",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"File Details"}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>i(null),children:e.jsx(U,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm font-medium truncate",children:r.name}),r.series&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Series: ",r.series]}),r.speaker&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Speaker: ",r.speaker]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Status: ",r.status||"N/A"]}),e.jsx("div",{className:"flex items-center gap-2 mt-3",children:e.jsxs(f,{variant:"outline",size:"sm",className:"text-xs",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"View File"]})})]})]})})]})}export{ie as RelationshipGraph};
//# sourceMappingURL=RelationshipGraph-D7-SgeTt.js.map
